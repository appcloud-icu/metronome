<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metronome</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
        }

        .metronome {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 30px;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .bpm-display {
            font-size: 4rem;
            font-weight: 700;
            margin: 20px 0;
            color: #4fc3f7;
        }

        .bpm-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .tempo-control {
            margin: 30px 0;
        }

        .tempo-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .tempo-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4fc3f7;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .tempo-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .tempo-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4fc3f7;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }

        .tempo-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
        }

        .tempo-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .tempo-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }

        .tempo-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .tempo-btn:active {
            transform: scale(0.95);
        }

        .play-btn {
            width: 80px;
            height: 80px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%);
            color: #fff;
            font-size: 2rem;
            cursor: pointer;
            margin-top: 30px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(79, 195, 247, 0.4);
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(79, 195, 247, 0.6);
        }

        .play-btn:active {
            transform: scale(0.95);
        }

        .play-btn.playing {
            background: linear-gradient(135deg, #ef5350 0%, #e53935 100%);
            box-shadow: 0 4px 15px rgba(239, 83, 80, 0.4);
        }

        .play-btn.playing:hover {
            box-shadow: 0 6px 20px rgba(239, 83, 80, 0.6);
        }

        .beat-indicator {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        .beat-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: background 0.1s, transform 0.1s;
        }

        .beat-dot.active {
            background: #4fc3f7;
            transform: scale(1.3);
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.8);
        }

        .beat-dot.accent {
            background: #ffca28;
            box-shadow: 0 0 10px rgba(255, 202, 40, 0.8);
        }
    </style>
</head>
<body>
    <div class="metronome">
        <h1>Metronome</h1>
        
        <div class="bpm-display" id="bpmDisplay">120</div>
        <div class="bpm-label">BPM</div>
        
        <div class="tempo-control">
            <input type="range" class="tempo-slider" id="tempoSlider" min="20" max="240" value="120">
            <div class="tempo-buttons">
                <button class="tempo-btn" id="decreaseBtn">−</button>
                <button class="tempo-btn" id="increaseBtn">+</button>
            </div>
        </div>
        
        <button class="play-btn" id="playBtn">▶</button>
        
        <div class="beat-indicator" id="beatIndicator">
            <div class="beat-dot"></div>
            <div class="beat-dot"></div>
            <div class="beat-dot"></div>
            <div class="beat-dot"></div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            // DOM Elements
            const bpmDisplay = document.getElementById('bpmDisplay');
            const tempoSlider = document.getElementById('tempoSlider');
            const playBtn = document.getElementById('playBtn');
            const decreaseBtn = document.getElementById('decreaseBtn');
            const increaseBtn = document.getElementById('increaseBtn');
            const beatIndicator = document.getElementById('beatIndicator');
            const beatDots = beatIndicator.querySelectorAll('.beat-dot');

            // State
            let bpm = 120;
            let isPlaying = false;
            let currentBeat = 0;
            let audioContext = null;
            let nextNoteTime = 0;
            let timerID = null;
            const beatsPerMeasure = 4;
            const lookahead = 25.0; // How frequently to call scheduling function (in milliseconds)
            const scheduleAheadTime = 0.1; // How far ahead to schedule audio (seconds)

            // Initialize Audio Context
            function initAudioContext() {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }

            // Create click sound
            function playClick(time, isAccent) {
                const osc = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                osc.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Higher pitch for accent beat
                osc.frequency.value = isAccent ? 1000 : 800;
                osc.type = 'sine';
                
                // Volume envelope
                gainNode.gain.setValueAtTime(isAccent ? 0.5 : 0.3, time);
                gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
                
                osc.start(time);
                osc.stop(time + 0.1);
            }

            // Schedule the next note
            function scheduleNote(beatNumber, time) {
                const isAccent = beatNumber === 0;
                playClick(time, isAccent);
                
                // Update visual indicator
                const delay = (time - audioContext.currentTime) * 1000;
                setTimeout(() => {
                    beatDots.forEach((dot, index) => {
                        dot.classList.remove('active', 'accent');
                        if (index === beatNumber) {
                            dot.classList.add('active');
                            if (isAccent) {
                                dot.classList.add('accent');
                            }
                        }
                    });
                }, Math.max(0, delay));
            }

            // Main scheduler
            function scheduler() {
                while (nextNoteTime < audioContext.currentTime + scheduleAheadTime) {
                    scheduleNote(currentBeat, nextNoteTime);
                    const secondsPerBeat = 60.0 / bpm;
                    nextNoteTime += secondsPerBeat;
                    currentBeat = (currentBeat + 1) % beatsPerMeasure;
                }
                timerID = setTimeout(scheduler, lookahead);
            }

            // Start metronome
            function start() {
                initAudioContext();
                isPlaying = true;
                currentBeat = 0;
                nextNoteTime = audioContext.currentTime;
                scheduler();
                playBtn.textContent = '⏹';
                playBtn.classList.add('playing');
            }

            // Stop metronome
            function stop() {
                isPlaying = false;
                if (timerID) {
                    clearTimeout(timerID);
                    timerID = null;
                }
                beatDots.forEach(dot => {
                    dot.classList.remove('active', 'accent');
                });
                playBtn.textContent = '▶';
                playBtn.classList.remove('playing');
            }

            // Toggle play/stop
            function toggle() {
                if (isPlaying) {
                    stop();
                } else {
                    start();
                }
            }

            // Update BPM
            function updateBPM(newBPM) {
                bpm = Math.min(240, Math.max(20, newBPM));
                bpmDisplay.textContent = bpm;
                tempoSlider.value = bpm;
            }

            // Event Listeners
            playBtn.addEventListener('click', toggle);

            tempoSlider.addEventListener('input', function() {
                updateBPM(Number(this.value) || bpm);
            });

            decreaseBtn.addEventListener('click', function() {
                updateBPM(bpm - 1);
            });

            increaseBtn.addEventListener('click', function() {
                updateBPM(bpm + 1);
            });

            // Keyboard controls
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space') {
                    e.preventDefault();
                    toggle();
                } else if (e.code === 'ArrowUp' || e.code === 'ArrowRight') {
                    e.preventDefault();
                    updateBPM(bpm + 1);
                } else if (e.code === 'ArrowDown' || e.code === 'ArrowLeft') {
                    e.preventDefault();
                    updateBPM(bpm - 1);
                }
            });
        })();
    </script>
</body>
</html>
